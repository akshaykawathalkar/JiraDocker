define("jira/tabs/tab-manager",["jira/util/events","jira/util/events/types","jira/util/events/reasons","jira/tabs/tab-manager/util","jquery","exports"],function(Events,Types,Reasons,TabManagerUtil,$,exports){exports.navigationTabs=(function(){var loadEvents={};var loadTab;var filterTab;var activeTab;var previousTab;var xhrObject;var tabs;var tabUtil;var CONST={filterTabSelector:JIRA.Page.mainContentCssSelector,tabsSelector:"ul.vertical.tabs li",tabsLinksSelector:"ul.vertical.tabs li a",requestParams:"decorator=none&contentOnly=true",stateRequestParams:"decorator=none&contentOnly=true&updateState=true",activeTabClass:"active",loadedTabClass:"loaded",tabParam:"filterView"};var runTabLoadEvent=function(hashMapID){if(loadEvents[hashMapID]&&loadEvents[hashMapID] instanceof Array){$(loadEvents[hashMapID]).each(function(){this()})}};var navigateToTab=function(tab,historyEvent,url){var tabAnchor=$(tab).find("a");var id=tabUtil.getTabParamFromUrl(url);var populateTab=function(contentObj){filterTab.empty();filterTab.html(contentObj);if(!historyEvent){tabUtil.saveHistoryItem(tabUtil.constructCompleteUrl(tabAnchor.attr("href")))}runTabLoadEvent(tabAnchor.attr("id"));activeTab.addClass(CONST.loadedTabClass);Events.trigger(Types.NEW_CONTENT_ADDED,[filterTab,Reasons.tabUpdated])};if(tabUtil.getTabParamFromUrl(activeTab.find("a").attr("href"))===id){return }if(url&&(activeTab.get(0)!==tab||url)){if(activeTab&&activeTab.length){previousTab=activeTab.removeClass(CONST.activeTabClass).removeClass(CONST.loadedTabClass)}activeTab=$(tab).addClass("active");if(xhrObject&&xhrObject.get(0)&&xhrObject.get(0).readyState!==4&&xhrObject.get(0).abort){if($.isFunction(xhrObject.hideThrobber)){xhrObject.hideThrobber()}xhrObject.get(0).abort()}filterTab.html($("<h2 />").text(tabAnchor.attr("title")));xhrObject=$($.ajax({method:"get",dataType:"html",url:url,data:CONST.requestParams,success:populateTab}).fail(function(jqXHR){if(jqXHR.status===401){window.location.reload()}else{if(jqXHR.statusText!=="abort"){var fragment=jqXHR.responseText&&jqXHR.responseText.match(/<body[^>]*>([\S\s]*)<\/body[^>]*>/);if(fragment&&fragment.length>0){filterTab.html('<div style="padding:0 20px">'+fragment[1]+"</div>")}}}})).throbber({target:tab})}};var handleBrowserNavigation=function(tabParam){var node=$([]);if(tabUtil.getTabParamFromUrl(activeTab.find("a").attr("href"))===tabParam){return }if(tabParam&&tabParam!==""){node=getTab(tabParam)}else{if(tabParam===""){node=loadTab}}if(node){navigateToTab(node,true,$(node).find("a").attr("href"))}};var getTab=function(url){var tabRegExp=CONST.getTabRegEx;var tabToTarget=url.match(tabRegExp);var tab;$(tabs).each(function(){var tabToCompare=$(this).find("a").attr("href").match(tabRegExp);if(tabToTarget&&tabToTarget.length>0&&tabToCompare[0]===tabToTarget[0]){tab=this}});return tab};window.addEventListener("popstate",function(){if(tabUtil){handleBrowserNavigation(tabUtil.getTabParamFromUrl(window.location.href))}});return{getActiveTab:function(){return activeTab},getProjectTab:function(){return filterTab},addLoadEvent:function(tabName,handler){loadEvents[tabName]=loadEvents[tabName]||[];if($.isFunction(handler)){loadEvents[tabName].push(handler)}},_getTabManagerUtil:function(){return tabUtil},_getNavigateToTabFunc:function(){return navigateToTab},init:function(opts){$.extend(CONST,opts);CONST.getTabRegEx=new RegExp(CONST.tabParam+"=[^&]*");tabUtil=new TabManagerUtil(window.location.href,CONST.tabParam,CONST.getTabRegEx);filterTab=$(CONST.filterTabSelector);tabs=$(CONST.tabsSelector).each(function(){if($(this).hasClass(CONST.activeTabClass)){activeTab=$(this);activeTab.addClass(CONST.loadedTabClass);loadTab=activeTab}});var addressTab=getTab(window.location.href);if(!window.location.href.match(CONST.getTabRegEx)&&loadTab){var initialUrl=$(loadTab).find("a").attr("href");tabUtil.replaceHistoryItem(tabUtil.updateInitialUrl(initialUrl))}var currentTabParam=tabUtil.getTabParamFromUrl(window.location.href);if(currentTabParam&&addressTab&&activeTab&&tabUtil.getTabParamFromUrl(activeTab.find("a").attr("href"))!==currentTabParam){var newUrl=$(addressTab).find("a").attr("href");navigateToTab($(addressTab),true,newUrl)}$(CONST.tabsLinksSelector).click(function(e){var href=$(this).attr("href");var tab=getTab(href);if(tab){navigateToTab(tab,false,href);e.preventDefault()}});if(opts&&opts.customInit){opts.customInit()}}}})()});AJS.namespace("jira.app.manageShared",null,require("jira/tabs/tab-manager"));AJS.namespace("JIRA.TabManager",null,require("jira/tabs/tab-manager"));