require(["jquery","underscore","aui/restful-table","wrm/context-path","jira/util/formatter","jira/ajs/ajax/ajax-util","jira/ajs/ajax/smart-ajax","jira/dialog/error-dialog","jira/workflows/workflow-transition-properties"],function(jQuery,_,RestfulTable,wrmContextPath,formatter,AjaxUtil,SmartAjax,ErrorDialog,WorkflowTransitionProperties){jQuery(function(){var transitionPropertiesResource=wrmContextPath()+"/rest/api/2/workflow/transitions/";var propertyTable=jQuery("#workflow-transition-properties-table");var workflowTransition=propertyTable.attr("data-workflowTransition");var workflowNameEncoded=encodeURIComponent(propertyTable.attr("data-workflowName"));var workflowModeEncoded=encodeURIComponent(propertyTable.attr("data-workflowMode"));var keyHeaderText=propertyTable.attr("data-key-header");var valueHeaderText=propertyTable.attr("data-value-header");var isEditable=propertyTable.attr("data-workflow-editable")==="true";var safeTrim=function(obj){return _.isString(obj)?jQuery.trim(obj):obj};var TransitionPropertyModel=RestfulTable.EntryModel.extend({initialize:function(){this.url=function(){var key=this.get("key")||"";return transitionPropertiesResource+workflowTransition+"/properties?workflowName="+workflowNameEncoded+"&workflowMode="+workflowModeEncoded+"&key="+key};RestfulTable.EntryModel.prototype.initialize.apply(this,arguments)},destroy:function(options){options=_.extend({},options,{data:{}});RestfulTable.EntryModel.prototype.destroy.call(this,options)},changedAttributes:function(newAttributes){var result={};_.each(newAttributes,function(item,key){item=safeTrim(item);if(this.get(key)!==item){result[key]=item}},this);return !_.isEmpty(result)?result:false},defaults:{value:""}});new RestfulTable({autoFocus:true,el:propertyTable,resources:{all:transitionPropertiesResource+workflowTransition+"/properties?workflowName="+workflowNameEncoded+"&workflowMode="+workflowModeEncoded,self:transitionPropertiesResource+workflowTransition+"/properties?workflowName="+workflowNameEncoded+"&workflowMode="+workflowModeEncoded},columns:[{id:"key",header:keyHeaderText,styleClass:"workflow-transition-properties-key-col",readView:WorkflowTransitionProperties.KeyView,createView:WorkflowTransitionProperties.CreateKeyView,editView:WorkflowTransitionProperties.EditKeyView,allowEdit:false},{id:"value",header:valueHeaderText,styleClass:"workflow-transition-properties-value-col",readView:WorkflowTransitionProperties.ValueView}],model:TransitionPropertyModel,allowEdit:isEditable,allowCreate:isEditable,allowDelete:isEditable,reverseOrder:true,noEntriesMsg:formatter.I18n.getText("admin.workflowtransition.no.entries.set")});jQuery(document).ajaxError(function(e,xhr,ajaxOptions){if(xhr.status!==400&&ajaxOptions.url.indexOf(transitionPropertiesResource)>=0){if(AjaxUtil.isWebSudoFailure(xhr)){SmartAjax.handleWebSudoError(ajaxOptions)}else{ErrorDialog.openErrorDialogForXHR(xhr)}}})})});