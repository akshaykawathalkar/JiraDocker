define("jira/xsrf",["jira/util/formatter","jquery"],function(formatter,$){var META_TOKEN_ID="atlassian-token";var PARAM_TOKEN_NAME="atl_token";var INPUT_TOKEN_NAME="atl_token";var tokenQueryParam=function(token){return formatter.format("{0}={1}",PARAM_TOKEN_NAME,token)};var replaceTokenInMeta=function(oldToken,newToken){var metaTokenSelector=formatter.format("meta#{0}",META_TOKEN_ID);$(metaTokenSelector).attr("content",newToken)};var replaceTokenInLinks=function(oldToken,newToken){$("a,link").each(function(){var link=$(this);var href=link.attr("href");if(href){link.attr("href",href.replace(tokenQueryParam(oldToken),tokenQueryParam(newToken)))}})};var replaceTokenInForms=function(oldToken,newToken){$("form").each(function(){var $form=$(this);var action=$form.attr("action");if(action){$form.attr("action",action.replace(tokenQueryParam(oldToken),tokenQueryParam(newToken)))}var formInputSelector=formatter.format('input[name="{0}"][value="{1}"]',INPUT_TOKEN_NAME,oldToken);$form.find(formInputSelector).each(function(){$(this).attr("value",newToken)})})};function updateTokenOnPage(newToken){var oldToken=atl_token();if(oldToken!==newToken){replaceTokenInMeta(oldToken,newToken);replaceTokenInLinks(oldToken,newToken);replaceTokenInForms(oldToken,newToken)}}return{updateTokenOnPage:updateTokenOnPage}});AJS.namespace("jira.xsrf",null,require("jira/xsrf"));AJS.namespace("JIRA.XSRF",null,require("jira/xsrf"));