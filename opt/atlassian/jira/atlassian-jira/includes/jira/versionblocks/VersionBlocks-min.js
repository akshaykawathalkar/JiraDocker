define("jira/versionblocks/version-blocks",["jquery"],function($){var VersionBlocks={ClassNames:{VERSION_LIST:"versions-list",VERSION_CONTAINER:"version-block-container",EXPANDED_CONTENT_CONTAINER:"version-issue-table"},init:function(){var classNames=VersionBlocks.ClassNames;var dataElement=$("."+classNames.VERSION_LIST).first();var urlEndpoint=getUrl();$(document).on("click","a[data-version-block]",function(e){var $a=$(this);var $root=$a.closest("."+classNames.VERSION_CONTAINER);var isActive=$root.data("expanded");var $container=$root.find("."+classNames.EXPANDED_CONTENT_CONTAINER);var $spinner=$("<span class='icon loading'></span>");if(!$container.size()){$container=$("<div/>").addClass(classNames.EXPANDED_CONTENT_CONTAINER).hide().appendTo($root)}var extraParams={};extraParams[(isActive)?"collapseVersion":"expandVersion"]=$root.find("[data-version-id]").data("version-id");var request=$.ajax({url:urlEndpoint,data:getUrlParams(extraParams),dataType:"json",beforeSend:function(){$a.closest("ul").append($("<li/>").append($spinner))}});request.always(function(){$spinner.parent("li").remove()});request.fail(function(jqXHR,textStatus,errorThrown){console.log("Failed to load issues for version. User-facing error to do, sorry :(",arguments)});if(!isActive){request.done(function(data,textStatus,jqXHR){var html=$("<div/>").html(data.content);var content=html.find("."+classNames.EXPANDED_CONTENT_CONTAINER);$container.hide().replaceWith(content).show()})}else{request.done(function(){$container.hide()})}request.done(function(){$root.data("expanded",!isActive)});e.preventDefault()});function getUrl(){var href;href=window.document.location.href;href=href.replace(window.document.location.hash,"");href=href.replace(window.document.location.search,"");return href}function getUrlParams(opts){var params={decorator:"none",contentOnly:true,noTitle:true,selectedTab:getSelectedTab(),pid:dataElement.data("project-id"),component:dataElement.data("component-id")};return $.extend(params,opts)}function getSelectedTab(){var selectedTab=dataElement.data("selected-tab");var paramString=""+window.document.location.search+window.document.location.hash;if(paramString.indexOf("selectedTab=")>-1){selectedTab=paramString.replace(/^.*selectedTab=(.*?)(?:&.*$|$)/,"$1");selectedTab=decodeURIComponent(selectedTab)}return selectedTab}}};return VersionBlocks});AJS.namespace("JIRA.VersionBlocks",null,require("jira/versionblocks/version-blocks"));